description: Publish the collection to ansible-galaxy. The GALAXY_API_TOKEN env var must be set to an API key
parameters:
  python-version:
    description: Python version of the circleci python image. Must be a valid tag for the cimg/python image
    type: string
    default: "3.11"
docker:
  - image: cimg/python:<<parameters.python-version>>
resource_class: small
steps:
  - checkout
  - install-requirements-txt
  - build-install-collection:
      install: false
      path: ./dist
  - run:
      name: Upload collection to ansible-galaxy
      command: ansible-galaxy collection publish ./dist/*.tar.gz --token ${GALAXY_API_TOKEN}
